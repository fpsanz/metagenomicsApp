ylab("Abundance (log2)")
otulong %>%
ggplot(aes(x=taxa, y=abundance,
fill = as.factor(eval(variablesUsuario) ),
color=as.factor(eval(variablesUsuario) ) ) )  +
geom_boxplot(alpha=0.4, width=0.5, position = position_dodge(width = 0.9))+
scale_y_continuous(trans = "log2")+
theme(axis.text.x = element_text(angle = 90),
text = element_text(size=18))+
labs(color ="Age", fill = "Age" )+
ylab("Abundance (log2)")
otulong %>%
ggplot(aes(x=taxa, y=abundance,
fill = as.factor(!!variablesUsuario ),
color=as.factor(!!variablesUsuario ) ) )  +
geom_boxplot(alpha=0.4, width=0.5, position = position_dodge(width = 0.9))+
scale_y_continuous(trans = "log2")+
theme(axis.text.x = element_text(angle = 90),
text = element_text(size=18))+
labs(color ="Age", fill = "Age" )+
ylab("Abundance (log2)")
otulong %>%
ggplot(aes(x=taxa, y=abundance,
fill = as.factor(!!~variablesUsuario ),
color=as.factor(!!~variablesUsuario ) ) )  +
geom_boxplot(alpha=0.4, width=0.5, position = position_dodge(width = 0.9))+
scale_y_continuous(trans = "log2")+
theme(axis.text.x = element_text(angle = 90),
text = element_text(size=18))+
labs(color ="Age", fill = "Age" )+
ylab("Abundance (log2)")
otulong %>%
ggplot(aes(x=taxa, y=abundance,
fill = !!~variablesUsuario ,
color=!!~variablesUsuario )  )  +
geom_boxplot(alpha=0.4, width=0.5, position = position_dodge(width = 0.9))+
scale_y_continuous(trans = "log2")+
theme(axis.text.x = element_text(angle = 90),
text = element_text(size=18))+
labs(color ="Age", fill = "Age" )+
ylab("Abundance (log2)")
otulong %>%
ggplot(aes(x=taxa, y=abundance,
fill = ~variablesUsuario ,
color=~variablesUsuario )  )  +
geom_boxplot(alpha=0.4, width=0.5, position = position_dodge(width = 0.9))+
scale_y_continuous(trans = "log2")+
theme(axis.text.x = element_text(angle = 90),
text = element_text(size=18))+
labs(color ="Age", fill = "Age" )+
ylab("Abundance (log2)")
otulong %>%
ggplot(aes(x=taxa, y=abundance,
fill = eval(variablesUsuario) ,
color= eval(variablesUsuario) )  )  +
geom_boxplot(alpha=0.4, width=0.5, position = position_dodge(width = 0.9))+
scale_y_continuous(trans = "log2")+
theme(axis.text.x = element_text(angle = 90),
text = element_text(size=18))+
labs(color ="Age", fill = "Age" )+
ylab("Abundance (log2)")
rlang::sym(eval(variablesUsuario))
rlang::sym(eval(variablesUsuario))
variableUsuario
otulong %>%
ggplot(aes(x=taxa, y=abundance,
fill = rlang::sym(eval(variableUsuario)) ,
color= eval(variableUsuario) )  )  +
geom_boxplot(alpha=0.4, width=0.5, position = position_dodge(width = 0.9))+
scale_y_continuous(trans = "log2")+
theme(axis.text.x = element_text(angle = 90),
text = element_text(size=18))+
labs(color ="Age", fill = "Age" )+
ylab("Abundance (log2)")
rlang::sym(eval(variableUsuario))
otulong %>%
ggplot(aes(x=taxa, y=abundance,
fill = rlang::sym(eval(variableUsuario)) ,
color= rlang::sym(eval(variableUsuario)) )  )  +
geom_boxplot(alpha=0.4, width=0.5, position = position_dodge(width = 0.9))+
scale_y_continuous(trans = "log2")+
theme(axis.text.x = element_text(angle = 90),
text = element_text(size=18))+
labs(color ="Age", fill = "Age" )+
ylab("Abundance (log2)")
otulong %>%
ggplot(aes(x=taxa, y=abundance,
fill = factor(rlang::sym(eval(variableUsuario))) ,
color= rlang::sym(eval(variableUsuario)) )  )  +
geom_boxplot(alpha=0.4, width=0.5, position = position_dodge(width = 0.9))+
scale_y_continuous(trans = "log2")+
theme(axis.text.x = element_text(angle = 90),
text = element_text(size=18))+
labs(color ="Age", fill = "Age" )+
ylab("Abundance (log2)")
otulong %>%
ggplot(aes(x=taxa, y=abundance,
fill = factor(rlang::sym(eval(variableUsuario))) ,
color= factor(rlang::sym(eval(variableUsuario)) ))  )  +
geom_boxplot(alpha=0.4, width=0.5, position = position_dodge(width = 0.9))+
scale_y_continuous(trans = "log2")+
theme(axis.text.x = element_text(angle = 90),
text = element_text(size=18))+
labs(color ="Age", fill = "Age" )+
ylab("Abundance (log2)")
otulong
otulong %>%
ggplot(aes(x=taxa, y=abundance,
fill = factor(rlang::sym(eval(variableUsuario))) ,
color= factor(rlang::sym(eval(variableUsuario)) ))  )
otulong %>%
ggplot(aes(x=taxa, y=abundance,
fill = as.factor(rlang::sym(eval(variableUsuario))) ,
color= as.factor(rlang::sym(eval(variableUsuario)) ))  )  +
geom_boxplot(alpha=0.4, width=0.5, position = position_dodge(width = 0.9))
otulong %>%
ggplot(aes_string(x=taxa, y=abundance,
fill = as.factor(rlang::sym(eval(variableUsuario))) ,
color= as.factor(rlang::sym(eval(variableUsuario)) ))  )  +
geom_boxplot(alpha=0.4, width=0.5, position = position_dodge(width = 0.9))+
scale_y_continuous(trans = "log2")+
theme(axis.text.x = element_text(angle = 90),
text = element_text(size=18))+
labs(color ="Age", fill = "Age" )+
ylab("Abundance (log2)")
otulong %>%
ggplot(aes_string(x=taxa, y=abundance,
fill = age ,
color= age))  +
geom_boxplot(alpha=0.4, width=0.5, position = position_dodge(width = 0.9))
otulong
otulong %>%
ggplot(aes(x=taxa, y=abundance,
fill = age ,
color= age))  +
geom_boxplot(alpha=0.4, width=0.5, position = position_dodge(width = 0.9))
otulong %>%
ggplot(aes_string(x=taxa, y=abundance,
fill = "age" ,
color= "age"))  +
geom_boxplot(alpha=0.4, width=0.5, position = position_dodge(width = 0.9))
otulong %>%
ggplot(aes(x=taxa, y=abundance,
fill = !!variablesUsuario ,
color= !!variablesUsuario))  +
geom_boxplot(alpha=0.4, width=0.5, position = position_dodge(width = 0.9))
otulong %>%
ggplot(aes(x=taxa, y=abundance,
fill = !!variableUsuario ,
color= !!variableUsuario))  +
geom_boxplot(alpha=0.4, width=0.5, position = position_dodge(width = 0.9))
otulong %>%
ggplot(aes(x=taxa, y=abundance,
fill = as.factor(!!variableUsuario) ,
color= !!variableUsuario))  +
geom_boxplot(alpha=0.4, width=0.5, position = position_dodge(width = 0.9))
otulong %>%
ggplot(aes(x=taxa, y=abundance,
fill = as.factor(!!variableUsuario) ,
color= as.factor(!!variableUsuario)))  +
geom_boxplot(alpha=0.4, width=0.5, position = position_dodge(width = 0.9))
otulong %>%
ggplot(aes(x=taxa, y=abundance,
fill = as.factor(!!variableUsuario) ,
color= as.factor(!!variableUsuario)))  +
geom_boxplot(alpha=0.4, width=0.5, position = position_dodge(width = 0.9))+
scale_y_continuous(trans = "log2")+
theme(axis.text.x = element_text(angle = 90),
text = element_text(size=18))+
labs(color ="Age", fill = "Age" )+
ylab("Abundance (log2)")
otulong %>%
ggplot(aes(x=taxa, y=abundance,
fill = as.factor(!!sym(variableUsuario)) ,
color= as.factor(!!sym(variableUsuario))))  +
geom_boxplot(alpha=0.4, width=0.5, position = position_dodge(width = 0.9))+
scale_y_continuous(trans = "log2")+
theme(axis.text.x = element_text(angle = 90),
text = element_text(size=18))+
labs(color ="Age", fill = "Age" )+
ylab("Abundance (log2)")
otulong %>%
ggplot(aes(x=taxa, y=abundance,
fill = as.factor(!!sym(variableUsuario)) ,
color= as.factor(!!sym(variableUsuario))))  +
geom_boxplot(alpha=0.4, width=0.5, position = position_dodge(width = 0.9))+
scale_y_continuous(trans = "log2")+
theme(axis.text.x = element_text(angle = 90),
text = element_text(size=18))+
labs(color ="Age", fill = "Age" )+
ylab("Abundance (log2)")+
facet_wrap(~as.factor(!!sym(variableUsuario)))
otulong %>%
ggplot(aes(x=taxa, y=abundance,
fill = as.factor(!!sym(variableUsuario)) ,
color= as.factor(!!sym(variableUsuario))))  +
geom_boxplot(alpha=0.4, width=0.5, position = position_dodge(width = 0.9))+
scale_y_continuous(trans = "log2")+
theme(axis.text.x = element_text(angle = 90),
text = element_text(size=18))+
labs(color ="Age", fill = "Age" )+
ylab("Abundance (log2)")+
facet_wrap(!!sym(variableUsuario))
otulong %>%
ggplot(aes(x=taxa, y=abundance,
fill = as.factor(!!sym(variableUsuario)) ,
color= as.factor(!!sym(variableUsuario))))  +
geom_boxplot(alpha=0.4, width=0.5, position = position_dodge(width = 0.9))+
scale_y_continuous(trans = "log2")+
theme(axis.text.x = element_text(angle = 90),
text = element_text(size=18))+
labs(color ="Age", fill = "Age" )+
ylab("Abundance (log2)")+
facet_wrap(sym(variableUsuario))
otulong %>%
ggplot(aes(x=taxa, y=abundance,
fill = as.factor(!!sym(variableUsuario)) ,
color= as.factor(!!sym(variableUsuario))))  +
geom_boxplot(alpha=0.4, width=0.5, position = position_dodge(width = 0.9))+
scale_y_continuous(trans = "log2")+
theme(axis.text.x = element_text(angle = 90),
text = element_text(size=18))+
labs(color ="Age", fill = "Age" )+
ylab("Abundance (log2)")+
facet_wrap(sym(variableUsuario), ncol = 2)
otulong %>%
ggplot(aes(x=taxa, y=abundance,
fill = as.factor(!!sym(variableUsuario)) ,
color= as.factor(!!sym(variableUsuario))))  +
geom_boxplot(alpha=0.4, width=0.5, position = position_dodge(width = 0.9))+
scale_y_continuous(trans = "log2")+
theme(axis.text.x = element_text(angle = 90),
text = element_text(size=14))+
labs(color ="Age", fill = "Age" )+
ylab("Abundance (log2)")+
facet_wrap(sym(variableUsuario), ncol = 2)
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
grupos
samplesGrupo <- exper$sampleId[ exper[variableUsuario] == i ]
samplesGrupo
samplesGrupo <- exper$sampleId[ exper[variableUsuario] ]
exper$sampleId
exper[variableUsuario]
samplesGrupo <- exper$sampleId[ ,exper[variableUsuario] ]
exper[variableUsuario]
variableUsuario
samplesGrupo <- exper$sampleId[ ,variableUsuario ]
samplesGrupo <- exper$sampleId[ variableUsuario ]
samplesGrupo
#samplesGrupo <- exper$sampleId[ variableUsuario ]
samplesGrupo <- exper$sampleId
samplesGrupo
topkk <- kk %>% rowwise %>%
mutate( mean = mean(c_across(samplesGrupo ))) %>%
as.data.frame() %>%
top_n(wt = mean, n = 25) %>%
select(-mean)
otulong <- topkk %>%
pivot_longer(cols = !starts_with("taxa"), names_to = "sample", values_to = "abundance")
otulong <- left_join(otulong, exper, by = c("sample"="sampleId"))
otulong %>%
ggplot(aes(x=taxa, y=abundance,
fill = as.factor(!!sym(variableUsuario)) ,
color= as.factor(!!sym(variableUsuario))))  +
geom_boxplot(alpha=0.4, width=0.5, position = position_dodge(width = 0.9))+
scale_y_continuous(trans = "log2")+
theme(axis.text.x = element_text(angle = 90),
text = element_text(size=14))+
labs(color ="Age", fill = "Age" )+
ylab("Abundance (log2)")+
facet_wrap(sym(variableUsuario), ncol = 2)
otulong %>%
ggplot(aes(x=taxa, y=abundance,
fill = as.factor(!!sym(variableUsuario)) ,
color= as.factor(!!sym(variableUsuario))))  +
geom_boxplot(alpha=0.4, width=0.5, position = position_dodge(width = 0.9))+
scale_y_continuous(trans = "log2")+
theme(axis.text.x = element_text(angle = 90),
text = element_text(size=14))+
labs(color ="Age", fill = "Age" )+
ylab("Abundance (log2)")+
facet_wrap(sym(variableUsuario), ncol = 2)
p <- otulong %>%
ggplot(aes(x=taxa, y=abundance,
fill = as.factor(!!sym(variableUsuario)) ,
color= as.factor(!!sym(variableUsuario))))  +
geom_boxplot(alpha=0.4, width=0.5, position = position_dodge(width = 0.9))+
scale_y_continuous(trans = "log2")+
theme(axis.text.x = element_text(angle = 90),
text = element_text(size=14))+
labs(color ="Age", fill = "Age" )+
ylab("Abundance (log2)")+
facet_wrap(sym(variableUsuario), ncol = 2)
return(p)
p
runApp()
runApp()
grupos
runApp()
runApp()
datos$exper
datos$experfiltered
runApp()
exper
varname
runApp()
runApp()
datos$experfiltered
input$selectvariable
variableUsuario
varsel <- paste0(varsel,collapse = "."))
varsel <- paste0(variableUsuario,collapse = "."))
varsel
varsel <- paste0(variableUsuario,collapse = "."))
varsel <- paste0(variableUsuario,collapse = ".")
varsel
otu <- datos$otufiltered
exper <- datos$experfiltered
otu
exper
grupos <- levels(factor( exper[,varsel] ))
grupos
kk <- otu %>% as.data.frame %>% rownames_to_column(var="taxa")
#samplesGrupo <- exper$sampleId[ variableUsuario ]
samplesGrupo <- exper$sampleId
samplesGrupo
topkk <- kk %>% rowwise %>%
mutate( mean = mean(c_across(samplesGrupo ))) %>%
as.data.frame() %>%
top_n(wt = mean, n = 25) %>%
select(-mean)
otulong <- topkk %>%
pivot_longer(cols = !starts_with("taxa"), names_to = "sample", values_to = "abundance")
otulong <- left_join(otulong, exper, by = c("sample"="sampleId"))
p <- otulong %>%
ggplot(aes(x=taxa, y=abundance,
fill = as.factor(!!sym(varsel)) ,
color= as.factor(!!sym(varsel))))  +
geom_boxplot(alpha=0.4, width=0.5, position = position_dodge(width = 0.9))+
scale_y_continuous(trans = "log2")+
theme(axis.text.x = element_text(angle = 90),
text = element_text(size=14))+
labs(color ="Age", fill = "Age" )+
ylab("Abundance (log2)")+
facet_wrap(sym(varsel), ncol = 2)
p
print(p)
runApp()
runApp()
library(shinybusy)
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
otuphylNorm <- datos$otuphylNorm
p <- psmelt(otuphylNorm) %>% group_by(OTU, group) %>%
summarise(Abundance = mean(Abundance))
datos$otuphylNorm
varsel
runApp()
varname
otuNorm
group
samplesdf <- data.frame(group=group)
samplesdf
rownames(samplesdf) <- samples
#crear objeto phyloseq
otuphyl <- phyloseq( otu_table(otu, taxa_are_rows = T ), sample_data( samplesdf ) )
otuphyl
otu_table(otu)
#crear objeto phyloseq
otuphyl <- phyloseq( otu_table(otu, taxa_are_rows = T ), sample_data( samplesdf ) )
otu_table(otuphyl)
otuTable(otuphylNorm)
class(otu)
class(otuNorm)
str(otu)
str(otuNorm)
as.character(exper$SampleId)
attr(otuNorm,"dimnames")[[2]] <- as.character(exper$sampleId)
as.character(exper$sampleId)
attr(otuNorm,"dimnames")[[2]] <- as.character(exper$sampleId)
# extrar factores del tratamiento
group <- factores
samplesdf <- data.frame(group=group)
rownames(samplesdf) <- samples
#crear objeto phyloseq
otuphyl <- phyloseq( otu_table(otu, taxa_are_rows = T ), sample_data( samplesdf ) )
otuphylNorm <- phyloseq( otu_table(otuNorm, taxa_are_rows = T ), sample_names( samplesdf ) )
otuphylNorm <- phyloseq( otu_table(otuNorm, taxa_are_rows = T ), sample_data( samplesdf ) )
otu_table(otuphylNorm)
runApp()
p <- psmelt(otuphylNorm) %>% group_by(OTU, group) %>%
summarise(Abundance = mean(Abundance))
p
p$Abundance <- p$Abundance*100
p <- p %>% mutate(menor01 = ifelse(Abundance<1, 1, 0)) %>%
mutate(newOTU = ifelse(menor01 == 1, "ETC<1%", OTU) ) %>%
group_by(newOTU, group) %>% summarise(Abundance2 = sum(Abundance))
names(p) <- c("OTU","group","Abundance")
colores <- c('#1f77b4', '#ff7f0e', '#2ca02c', '#d62728', '#9467bd', '#8c564b', '#e377c2', '#7f7f7f', '#bcbd22', '#17becf')
colorRamps <- scales::colour_ramp(colores)
coloresRamp <- colorRamps(seq(0,1,length=length(unique(p$OTU)) ))
p %>% ggplot(aes_string(x = "group", y="Abundance", fill="OTU")) +
geom_bar(stat = "identity", position = "stack",
color = "black", show.legend = T, width = 0.5, size=0.01 ) +
scale_fill_manual(values= coloresRamp ) +
theme_bw() +
theme(axis.text.x = element_text(angle = 0),
legend.position = "right",
text = element_text(size=10),
legend.key.size = unit(0.5, "cm") )+
guides(fill = guide_legend(ncol=1))
p <- p %>% ggplot(aes_string(x = "group", y="Abundance", fill="OTU")) +
geom_bar(stat = "identity", position = "stack",
color = "black", show.legend = T, width = 0.5, size=0.01 ) +
scale_fill_manual(values= coloresRamp ) +
theme_bw() +
theme(axis.text.x = element_text(angle = 0),
legend.position = "right",
text = element_text(size=10),
legend.key.size = unit(0.5, "cm") )+
guides(fill = guide_legend(ncol=1))
print(p)
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
input$selectvariable
runApp()
runApp()
runApp()
runApp()
shiny::runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
View(p)
psmelt(otuphylNorm)
sampleSelection
p <- psmelt(otuphylNorm) %>% filter(sample == sampleSelection ) %>%
group_by(OTU, group) %>%
summarise(Abundance = mean(Abundance))
p <- psmelt(otuphylNorm) %>% filter(sample %in% sampleSelection ) %>%
group_by(OTU, group) %>%
summarise(Abundance = mean(Abundance))
psmelt(otuphylNorm)
psmelt(otuphylNorm) %>% filter(Sample %in% "C_A2_M4" )
psmelt(otuphylNorm) %>% filter(Sample %in% c("C_A2_M4", "C_A3_F4") )
p <- psmelt(otuphylNorm) %>% filter(Sample %in% sampleSelection ) %>%
group_by(OTU, group) %>%
summarise(Abundance = mean(Abundance))
p$Abundance <- p$Abundance*100
p <- p %>% mutate(menor01 = ifelse(Abundance<1, 1, 0)) %>%
mutate(newOTU = ifelse(menor01 == 1, "ETC<1%", OTU) ) %>%
group_by(newOTU, group) %>% summarise(Abundance2 = sum(Abundance))
names(p) <- c("OTU","group","Abundance")
colores <- c('#1f77b4', '#ff7f0e', '#2ca02c', '#d62728', '#9467bd', '#8c564b', '#e377c2', '#7f7f7f', '#bcbd22', '#17becf')
colorRamps <- scales::colour_ramp(colores)
coloresRamp <- colorRamps(seq(0,1,length=length(unique(p$OTU)) ))
p <- p %>% ggplot(aes_string(x = "group", y="Abundance", fill="OTU")) +
geom_bar(stat = "identity", position = "stack",
color = "black", show.legend = T, width = 0.5, size=0.01 ) +
scale_fill_manual(values= coloresRamp ) +
theme_bw() +
theme(axis.text.x = element_text(angle = 0),
legend.position = "right",
text = element_text(size=14),
legend.key.size = unit(0.5, "cm") )+
guides(fill = guide_legend(ncol=1))
print(p)
p
plot(p)
runApp()
runApp()
sampleSelection
p
psmelt(otuphylNorm) %>% filter(Sample %in% sampleSelection )
p <- psmelt(otuphylNorm) %>% filter(Sample %in% sampleSelection ) %>%
group_by(OTU, group, Sample) %>%
summarise(Abundance = mean(Abundance))
p
p$Abundance <- p$Abundance*100
p <- p %>% mutate(menor01 = ifelse(Abundance<1, 1, 0)) %>%
mutate(newOTU = ifelse(menor01 == 1, "ETC<1%", OTU) ) %>%
group_by(newOTU, group, Sample) %>% summarise(Abundance2 = sum(Abundance))
p
runApp()
runApp()
runApp()
runApp()
runApp()
varsel
exper[varsel]
runApp()
runApp()
varsel
datos$exper[varsel]
runApp()
